# Complete Guide: Configuring Multiple Domains on Namecheap VPS

## VPS Specifications
- **Provider**: Namecheap
- **OS**: Ubuntu (Latest LTS recommended)
- **RAM**: 6GB
- **CPU**: 4 cores
- **Storage**: 120GB SSD

## Prerequisites Checklist
- [ ] VPS is running and accessible via SSH
- [ ] Root or sudo access
- [ ] Domain names registered and accessible in Namecheap account
- [ ] Basic knowledge of command line

---

## Step 1: Initial VPS Setup

### Connect to Your VPS
```bash
ssh root@your-vps-ip-address
# OR if using a non-root user:
ssh username@your-vps-ip-address
```

### Update System
```bash
sudo apt update && sudo apt upgrade -y
```

### Install Essential Packages
```bash
sudo apt install -y curl wget git unzip software-properties-common
```

---

## Step 2: Install Web Server (Apache or Nginx)

### Option A: Apache Web Server
```bash
# Install Apache
sudo apt install apache2 -y

# Enable Apache modules for virtual hosts
sudo a2enmod rewrite
sudo a2enmod ssl
sudo systemctl restart apache2

# Check status
sudo systemctl status apache2
```

### Option B: Nginx Web Server (Alternative)
```bash
# Install Nginx
sudo apt install nginx -y

# Start and enable Nginx
sudo systemctl start nginx
sudo systemctl enable nginx

# Check status
sudo systemctl status nginx
```

---

## Step 3: Configure Domain DNS Settings

### In Namecheap Dashboard:
1. **Login** to your Namecheap account
2. **Go to** Domain List â†’ Manage your domain
3. **Navigate to** Advanced DNS tab
4. **Add these DNS records** for each domain:

| Type | Host | Value | TTL |
|------|------|-------|-----|
| A Record | @ | YOUR_VPS_IP | Automatic |
| A Record | www | YOUR_VPS_IP | Automatic |
| CNAME | * | @ | Automatic |

**Important**: Replace `YOUR_VPS_IP` with your actual VPS IP address

### DNS Propagation
- DNS changes can take 24-48 hours to fully propagate
- Use tools like `dig` or online DNS checkers to verify

---

## Step 4: Configure Virtual Hosts

### For Apache Virtual Hosts

#### Create Directory Structure
```bash
# Create directories for each domain
sudo mkdir -p /var/www/domain1.com/public_html
sudo mkdir -p /var/www/domain2.com/public_html
sudo mkdir -p /var/www/domain3.com/public_html

# Set proper ownership
sudo chown -R $USER:$USER /var/www/domain1.com/public_html
sudo chown -R $USER:$USER /var/www/domain2.com/public_html
sudo chown -R $USER:$USER /var/www/domain3.com/public_html

# Set permissions
sudo chmod -R 755 /var/www
```

#### Create Test HTML Files
```bash
# Create test page for domain1
echo "<html><body><h1>Welcome to Domain1.com</h1></body></html>" > /var/www/domain1.com/public_html/index.html

# Create test page for domain2  
echo "<html><body><h1>Welcome to Domain2.com</h1></body></html>" > /var/www/domain2.com/public_html/index.html
```

#### Create Virtual Host Configuration Files
```bash
# Create virtual host for domain1
sudo nano /etc/apache2/sites-available/domain1.com.conf
```

**Add this configuration:**
```apache
<VirtualHost *:80>
    ServerAdmin admin@domain1.com
    ServerName domain1.com
    ServerAlias www.domain1.com
    DocumentRoot /var/www/domain1.com/public_html
    
    ErrorLog ${APACHE_LOG_DIR}/domain1.com_error.log
    CustomLog ${APACHE_LOG_DIR}/domain1.com_access.log combined
    
    <Directory /var/www/domain1.com/public_html>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
```

**Repeat for each domain**, changing the domain name and paths accordingly.

#### Enable Virtual Hosts
```bash
# Enable each site
sudo a2ensite domain1.com.conf
sudo a2ensite domain2.com.conf
sudo a2ensite domain3.com.conf

# Disable default Apache site
sudo a2dissite 000-default.conf

# Test configuration
sudo apache2ctl configtest

# Reload Apache
sudo systemctl reload apache2
```

### For Nginx Virtual Hosts (Alternative)

#### Create Directory Structure
```bash
# Same directory creation as Apache above
sudo mkdir -p /var/www/domain1.com/public_html
# ... etc
```

#### Create Nginx Server Blocks
```bash
sudo nano /etc/nginx/sites-available/domain1.com
```

**Add this configuration:**
```nginx
server {
    listen 80;
    listen [::]:80;
    
    root /var/www/domain1.com/public_html;
    index index.html index.htm index.php;
    
    server_name domain1.com www.domain1.com;
    
    location / {
        try_files $uri $uri/ =404;
    }
    
    access_log /var/log/nginx/domain1.com.access.log;
    error_log /var/log/nginx/domain1.com.error.log;
}
```

#### Enable Nginx Sites
```bash
# Create symbolic links to enable sites
sudo ln -s /etc/nginx/sites-available/domain1.com /etc/nginx/sites-enabled/
sudo ln -s /etc/nginx/sites-available/domain2.com /etc/nginx/sites-enabled/

# Test configuration
sudo nginx -t

# Reload Nginx
sudo systemctl reload nginx
```

---

## Step 5: Install SSL Certificates (Let's Encrypt)

### Install Certbot
```bash
# For Apache
sudo apt install certbot python3-certbot-apache -y

# For Nginx  
sudo apt install certbot python3-certbot-nginx -y
```

### Generate SSL Certificates
```bash
# For Apache (run for each domain)
sudo certbot --apache -d domain1.com -d www.domain1.com
sudo certbot --apache -d domain2.com -d www.domain2.com

# For Nginx (run for each domain)
sudo certbot --nginx -d domain1.com -d www.domain1.com
sudo certbot --nginx -d domain2.com -d www.domain2.com
```

### Setup Auto-Renewal
```bash
# Test auto-renewal
sudo certbot renew --dry-run

# Auto-renewal is typically set up automatically via systemd timer
sudo systemctl list-timers | grep certbot
```

---

## Step 6: Configure Firewall

### Install and Configure UFW
```bash
# Install UFW
sudo apt install ufw -y

# Set default policies
sudo ufw default deny incoming
sudo ufw default allow outgoing

# Allow essential services
sudo ufw allow ssh
sudo ufw allow 'Apache Full'  # or 'Nginx Full' if using Nginx
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# Enable firewall
sudo ufw enable

# Check status
sudo ufw status
```

---

## Step 7: Install PHP and Database (Optional)

### Install PHP
```bash
# Install PHP and common modules
sudo apt install php php-mysql php-curl php-gd php-json php-zip php-mbstring -y

# For Apache
sudo apt install libapache2-mod-php -y

# For Nginx
sudo apt install php-fpm -y
```

### Install MySQL/MariaDB
```bash
# Install MariaDB
sudo apt install mariadb-server -y

# Secure installation
sudo mysql_secure_installation

# Create databases for your domains (optional)
sudo mysql -u root -p
```

**MySQL commands:**
```sql
CREATE DATABASE domain1_db;
CREATE DATABASE domain2_db;
CREATE USER 'domain1_user'@'localhost' IDENTIFIED BY 'strong_password';
GRANT ALL PRIVILEGES ON domain1_db.* TO 'domain1_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

---

## Step 8: Performance Optimization

### Enable Compression (Apache)
```bash
sudo a2enmod deflate
sudo systemctl reload apache2
```

### Enable Gzip (Nginx)
Add to `/etc/nginx/nginx.conf`:
```nginx
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;
```

### Configure Caching
```bash
# For Apache
sudo a2enmod expires
sudo a2enmod headers

# Add to your virtual host files:
# ExpiresActive On
# ExpiresByType image/png "access plus 1 month"
# ExpiresByType text/css "access plus 1 month"
```

---

## Step 9: Monitoring and Maintenance

### Install Monitoring Tools
```bash
# Install htop for system monitoring
sudo apt install htop -y

# Install logwatch for log monitoring
sudo apt install logwatch -y
```

### Regular Maintenance Tasks
```bash
# Weekly system updates
sudo apt update && sudo apt upgrade -y

# Check disk usage
df -h

# Check memory usage
free -h

# Monitor active connections
ss -tuln
```

### Log Locations
- **Apache Logs**: `/var/log/apache2/`
- **Nginx Logs**: `/var/log/nginx/`
- **System Logs**: `/var/log/syslog`

---

## Step 10: Backup Strategy

### Create Backup Script
```bash
sudo nano /usr/local/bin/backup-websites.sh
```

**Backup script content:**
```bash
#!/bin/bash
BACKUP_DIR="/backup/websites"
DATE=$(date +%Y%m%d_%H%M%S)

# Create backup directory
mkdir -p $BACKUP_DIR

# Backup websites
tar -czf $BACKUP_DIR/websites_$DATE.tar.gz /var/www/

# Backup databases (if using MySQL)
mysqldump --all-databases > $BACKUP_DIR/databases_$DATE.sql

# Keep only last 7 days of backups
find $BACKUP_DIR -type f -mtime +7 -delete

echo "Backup completed: $DATE"
```

### Make Script Executable and Schedule
```bash
sudo chmod +x /usr/local/bin/backup-websites.sh

# Add to crontab for daily backups at 2 AM
sudo crontab -e
# Add this line:
# 0 2 * * * /usr/local/bin/backup-websites.sh
```

---

## Troubleshooting Common Issues

### Domain Not Loading
1. **Check DNS**: Verify A records point to correct IP
2. **Check Virtual Host**: Ensure configuration is correct
3. **Check Firewall**: Ensure ports 80/443 are open
4. **Check Logs**: Review error logs for specific issues

### SSL Certificate Issues
```bash
# Check certificate status
sudo certbot certificates

# Force renewal
sudo certbot renew --force-renewal

# Check SSL configuration
sudo nginx -t  # or sudo apache2ctl configtest
```

### Performance Issues
```bash
# Check system resources
htop

# Check Apache/Nginx processes
ps aux | grep apache2
ps aux | grep nginx

# Monitor disk I/O
iotop
```

---

## Security Best Practices

1. **Keep System Updated**: Regular security updates
2. **Strong Passwords**: Use complex passwords for all accounts
3. **SSH Key Authentication**: Disable password-based SSH login
4. **Firewall Configuration**: Only allow necessary ports
5. **Regular Backups**: Automated backup strategy
6. **SSL Certificates**: Always use HTTPS
7. **File Permissions**: Proper file and directory permissions
8. **Monitor Logs**: Regular log review for suspicious activity

---

## Final Checklist

- [ ] VPS properly configured and updated
- [ ] Web server (Apache/Nginx) installed and running
- [ ] DNS records configured for all domains
- [ ] Virtual hosts configured for each domain
- [ ] SSL certificates installed and auto-renewal enabled
- [ ] Firewall configured and enabled
- [ ] Backup strategy implemented
- [ ] Monitoring tools installed
- [ ] Test all domains load correctly
- [ ] Performance optimization applied

---

## Useful Commands Reference

```bash
# Check web server status
sudo systemctl status apache2
sudo systemctl status nginx

# Restart services
sudo systemctl restart apache2
sudo systemctl restart nginx

# Check open ports
sudo netstat -tlnp

# Check disk space
df -h

# Check memory usage
free -h

# View recent logs
sudo tail -f /var/log/apache2/error.log
sudo tail -f /var/log/nginx/error.log

# Test domain resolution
nslookup domain1.com
dig domain1.com
```
