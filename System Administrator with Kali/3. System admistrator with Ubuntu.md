# Ubuntu Server System Administrator Cheat Sheet

## Table of Contents
1. [System Information & Monitoring](#system-information--monitoring)
2. [User & Permission Management](#user--permission-management)
3. [Process Management](#process-management)
4. [Network Management](#network-management)
5. [Storage & File System Management](#storage--file-system-management)
6. [Package Management](#package-management)
7. [Service Management (systemd)](#service-management-systemd)
8. [Log Management](#log-management)
9. [Security & Firewall](#security--firewall)
10. [Backup & Recovery](#backup--recovery)
11. [Performance Troubleshooting](#performance-troubleshooting)
12. [Cron Jobs & Automation](#cron-jobs--automation)
13. [Docker Management](#docker-management)
14. [Database Management](#database-management)
15. [Web Server Management](#web-server-management)
16. [SSL/TLS Certificate Management](#ssltls-certificate-management)
17. [Emergency Recovery](#emergency-recovery)

---

## System Information & Monitoring

### Basic System Information
```bash
# System info
uname -a                    # Kernel info
lsb_release -a             # Ubuntu version
hostnamectl                # Hostname and system info
uptime                     # System uptime and load
whoami                     # Current user
id                         # User ID and groups
w                          # Who is logged in
last                       # Last login history

# Hardware info
lscpu                      # CPU information
lsmem                      # Memory information
lsblk                      # Block devices
lsusb                      # USB devices
lspci                      # PCI devices
dmidecode -t system        # System manufacturer info
```

### Resource Monitoring
```bash
# Memory usage
free -h                    # Memory usage human readable
cat /proc/meminfo          # Detailed memory info

# Disk usage
df -h                      # Disk space usage
du -sh /path/to/dir        # Directory size
du -h --max-depth=1 /      # Top-level directory sizes
ncdu /                     # Interactive disk usage

# CPU and process monitoring
top                        # Real-time process view
htop                       # Better process viewer
ps aux                     # All running processes
ps -ef --forest            # Process tree
pstree                     # Process tree visual

# I/O monitoring
iotop                      # I/O usage by process
iostat 1                   # I/O statistics
vmstat 1                   # Virtual memory statistics
sar -u 1 10               # CPU utilization
```

### Network Monitoring
```bash
# Network connections
ss -tuln                   # Listening ports
ss -tup                    # Active connections
netstat -tuln             # Alternative to ss
lsof -i                   # Files opened by network connections

# Network traffic
nethogs                    # Network usage by process
iftop                      # Network traffic by connection
vnstat                     # Network statistics
tcpdump -i eth0           # Packet capture
```

---

## User & Permission Management

### User Management
```bash
# Add/remove users
sudo adduser username              # Add user interactively
sudo useradd -m -s /bin/bash user  # Add user with home dir
sudo userdel -r username           # Delete user and home
sudo usermod -aG sudo username     # Add user to sudo group
sudo passwd username               # Change user password
sudo chage -l username             # Password aging info

# User information
cat /etc/passwd               # All users
getent passwd                 # All users (including LDAP)
groups username               # User's groups
id username                   # User ID and groups
finger username               # User information
```

### Permission Management
```bash
# File permissions
chmod 755 file                # rwxr-xr-x
chmod u+x,g-w,o+r file        # Symbolic permissions
chown user:group file         # Change ownership
chgrp group file              # Change group
find /path -type f -perm 777  # Find files with 777 permissions

# Special permissions
chmod +t /tmp                 # Sticky bit
chmod g+s directory           # SetGID
chmod u+s file                # SetUID

# Access Control Lists (ACL)
getfacl file                  # Get ACL
setfacl -m u:user:rwx file    # Set ACL for user
setfacl -x u:user file        # Remove ACL for user
setfacl -b file               # Remove all ACLs
```

### Sudo Management
```bash
# Sudo configuration
sudo visudo                   # Edit sudoers file safely
sudo -l                       # List sudo permissions
sudo su - user                # Switch to user with environment
sudo -u user command          # Run command as user

# Common sudoers entries
%sudo ALL=(ALL:ALL) ALL       # Sudo group full access
user ALL=(ALL) NOPASSWD: /bin/systemctl restart nginx
```

---

## Process Management

### Process Control
```bash
# Start/stop processes
nohup command &               # Run in background, ignore hangup
disown                        # Detach job from shell
jobs                          # List active jobs
fg %1                         # Bring job to foreground
bg %1                         # Send job to background

# Kill processes
kill PID                      # Terminate process
kill -9 PID                   # Force kill
killall process_name          # Kill all processes by name
pkill -f pattern              # Kill processes matching pattern
pgrep -f pattern              # Find PIDs matching pattern

# Process priority
nice -n 10 command            # Start with priority 10
renice 5 PID                  # Change priority of running process
```

### Advanced Process Management
```bash
# Process monitoring
strace -p PID                 # Trace system calls
ltrace -p PID                 # Trace library calls
gdb -p PID                    # Debug running process
lsof -p PID                   # Files opened by process

# Process limits
ulimit -a                     # Show all limits
ulimit -n 4096               # Set file descriptor limit
echo "user soft nofile 4096" >> /etc/security/limits.conf
```

---

## Network Management

### Network Configuration
```bash
# Network interfaces (netplan - Ubuntu 18.04+)
sudo nano /etc/netplan/01-netcfg.yaml
sudo netplan apply            # Apply configuration
sudo netplan try              # Test configuration

# Static IP configuration example:
network:
  version: 2
  ethernets:
    enp0s3:
      dhcp4: no
      addresses: [192.168.1.100/24]
      gateway4: 192.168.1.1
      nameservers:
        addresses: [8.8.8.8, 1.1.1.1]
```

### Network Troubleshooting
```bash
# Connectivity testing
ping -c 4 google.com          # Test connectivity
traceroute google.com         # Trace route
mtr google.com                # Continuous trace
telnet host port              # Test port connectivity
nc -zv host port              # Test port with netcat

# DNS troubleshooting
nslookup domain.com           # DNS lookup
dig domain.com                # Detailed DNS info
dig @8.8.8.8 domain.com       # Query specific DNS server
systemd-resolve --status      # DNS resolution status

# Network interface management
ip addr show                  # Show IP addresses
ip route show                 # Show routing table
ip link set dev eth0 up       # Bring interface up
ip addr add 192.168.1.100/24 dev eth0  # Add IP address
```

### Firewall and Security
```bash
# UFW (Uncomplicated Firewall)
sudo ufw enable               # Enable firewall
sudo ufw status verbose       # Check status
sudo ufw allow 22             # Allow SSH
sudo ufw allow 80/tcp         # Allow HTTP
sudo ufw deny from 192.168.1.100  # Block IP
sudo ufw delete allow 80      # Remove rule

# iptables (advanced)
sudo iptables -L              # List rules
sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
sudo iptables-save > /etc/iptables/rules.v4
```

---

## Storage & File System Management

### Disk Management
```bash
# Disk information
fdisk -l                      # List all disks
parted -l                     # List partitions
lsblk -f                      # Block devices with filesystem

# Partition management
sudo fdisk /dev/sdb           # Partition disk
sudo parted /dev/sdb          # Alternative partitioning tool
sudo mkfs.ext4 /dev/sdb1      # Create filesystem
sudo e2label /dev/sdb1 DATA   # Label filesystem
```

### Mount Management
```bash
# Mounting
sudo mount /dev/sdb1 /mnt/data        # Mount filesystem
sudo umount /dev/sdb1                 # Unmount
mount | column -t                     # Show mounted filesystems
findmnt                               # Tree view of mounts

# Persistent mounting (/etc/fstab)
/dev/sdb1 /mnt/data ext4 defaults 0 2
UUID=abc123 /mnt/data ext4 defaults 0 2

# Get UUID
sudo blkid /dev/sdb1
lsblk -f
```

### LVM Management
```bash
# Physical volumes
sudo pvcreate /dev/sdb1       # Create physical volume
sudo pvdisplay                # Show physical volumes
sudo pvs                      # Short PV info

# Volume groups
sudo vgcreate vg01 /dev/sdb1  # Create volume group
sudo vgdisplay                # Show volume groups
sudo vgextend vg01 /dev/sdc1  # Add PV to VG

# Logical volumes
sudo lvcreate -L 10G -n lv01 vg01     # Create 10GB LV
sudo lvdisplay                         # Show logical volumes
sudo lvextend -L +5G /dev/vg01/lv01   # Extend LV
sudo resize2fs /dev/vg01/lv01         # Resize filesystem
```

### File System Maintenance
```bash
# File system check
sudo fsck /dev/sdb1           # Check filesystem
sudo fsck -f /dev/sdb1        # Force check
sudo e2fsck -p /dev/sdb1      # Auto-fix issues

# File system tuning
sudo tune2fs -l /dev/sdb1     # Show filesystem info
sudo tune2fs -c 30 /dev/sdb1  # Set max mount count
sudo tune2fs -m 1 /dev/sdb1   # Set reserved blocks (1%)
```

---

## Package Management

### APT Package Management
```bash
# Update package lists and upgrade
sudo apt update               # Update package lists
sudo apt upgrade              # Upgrade packages
sudo apt full-upgrade         # Full upgrade including kernel
sudo apt dist-upgrade         # Distribution upgrade

# Package installation/removal
sudo apt install package      # Install package
sudo apt remove package       # Remove package
sudo apt purge package        # Remove package and config
sudo apt autoremove           # Remove unused packages
sudo apt autoclean            # Clean package cache

# Package information
apt search keyword            # Search packages
apt show package              # Show package info
apt list --installed          # List installed packages
apt list --upgradable         # List upgradable packages
dpkg -l                       # List all packages
dpkg -L package               # List package files
```

### Repository Management
```bash
# Add/remove repositories
sudo add-apt-repository ppa:user/repo
sudo add-apt-repository --remove ppa:user/repo
sudo apt-key add keyfile      # Add GPG key
sudo apt-key list             # List GPG keys

# Repository files
ls /etc/apt/sources.list.d/   # Additional repositories
sudo nano /etc/apt/sources.list  # Main repository file
```

### Snap Packages
```bash
sudo snap install package     # Install snap package
sudo snap remove package      # Remove snap package
snap list                     # List installed snaps
snap find keyword             # Search snaps
sudo snap refresh             # Update all snaps
```

---

## Service Management (systemd)

### Service Control
```bash
# Service status and control
sudo systemctl status service         # Check service status
sudo systemctl start service          # Start service
sudo systemctl stop service           # Stop service
sudo systemctl restart service        # Restart service
sudo systemctl reload service         # Reload configuration
sudo systemctl enable service         # Enable at boot
sudo systemctl disable service        # Disable at boot

# System state
systemctl list-units                  # List all units
systemctl list-units --failed         # List failed units
systemctl list-unit-files             # List unit files
systemctl get-default                 # Show default target
sudo systemctl set-default multi-user.target  # Set default target
```

### Service Management
```bash
# Create custom service
sudo nano /etc/systemd/system/myapp.service

[Unit]
Description=My Application
After=network.target

[Service]
Type=simple
User=myuser
WorkingDirectory=/opt/myapp
ExecStart=/opt/myapp/start.sh
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target

# Reload and start
sudo systemctl daemon-reload
sudo systemctl enable myapp
sudo systemctl start myapp
```

### System Logs
```bash
# Journal logs
journalctl                    # All logs
journalctl -u service         # Service-specific logs
journalctl -f                 # Follow logs
journalctl --since "1 hour ago"  # Recent logs
journalctl --until "2021-01-01"  # Logs until date
journalctl -p err             # Error level logs only
journalctl --disk-usage       # Journal disk usage
```

---

## Log Management

### Log Files
```bash
# Common log locations
/var/log/syslog              # System messages
/var/log/auth.log            # Authentication logs
/var/log/apache2/            # Apache logs
/var/log/nginx/              # Nginx logs
/var/log/mysql/              # MySQL logs

# Log viewing
tail -f /var/log/syslog      # Follow log file
tail -n 100 /var/log/syslog  # Last 100 lines
grep "error" /var/log/syslog # Search in logs
zcat /var/log/syslog.1.gz    # View compressed logs
```

### Log Rotation
```bash
# Logrotate configuration
sudo nano /etc/logrotate.d/myapp

/var/log/myapp/*.log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 644 myuser mygroup
    postrotate
        systemctl reload myapp
    endscript
}

# Test logrotate
sudo logrotate -d /etc/logrotate.d/myapp  # Dry run
sudo logrotate -f /etc/logrotate.d/myapp  # Force rotation
```

---

## Security & Firewall

### SSH Security
```bash
# SSH configuration
sudo nano /etc/ssh/sshd_config

Port 2222                    # Change default port
PermitRootLogin no           # Disable root login
PasswordAuthentication no    # Use keys only
MaxAuthTries 3               # Limit auth attempts
AllowUsers user1 user2       # Allow specific users

sudo systemctl restart ssh   # Apply changes
```

### SSH Key Management
```bash
# Generate SSH keys
ssh-keygen -t rsa -b 4096 -C "user@host"
ssh-keygen -t ed25519 -C "user@host"

# Copy public key to server
ssh-copy-id user@server
# Or manually:
cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
```

### Fail2ban (Intrusion Prevention)
```bash
# Install and configure
sudo apt install fail2ban
sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
sudo nano /etc/fail2ban/jail.local

[sshd]
enabled = true
port = ssh
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
bantime = 3600

sudo systemctl enable fail2ban
sudo systemctl start fail2ban
sudo fail2ban-client status   # Check status
sudo fail2ban-client status sshd  # Check SSH jail
```

---

## Backup & Recovery

### File Backup
```bash
# rsync backup
rsync -avz /source/ /destination/      # Local backup
rsync -avz /source/ user@host:/dest/   # Remote backup
rsync -avz --delete /source/ /dest/    # Mirror (delete extra files)

# tar backup
tar -czf backup.tar.gz /path/to/backup  # Create compressed archive
tar -xzf backup.tar.gz                  # Extract archive
tar -tzf backup.tar.gz                  # List archive contents

# System backup script example
#!/bin/bash
BACKUP_DIR="/backup/$(date +%Y-%m-%d)"
mkdir -p $BACKUP_DIR
rsync -avz --exclude='/proc' --exclude='/sys' --exclude='/tmp' \
      --exclude='/dev' --exclude='/mnt' / $BACKUP_DIR/
```

### Database Backup
```bash
# MySQL backup
mysqldump -u root -p database_name > backup.sql
mysqldump -u root -p --all-databases > all_databases.sql
mysql -u root -p database_name < backup.sql  # Restore

# PostgreSQL backup
pg_dump database_name > backup.sql
pg_dumpall > all_databases.sql
psql database_name < backup.sql  # Restore
```

---

## Performance Troubleshooting

### System Performance Analysis
```bash
# CPU analysis
top -d 1                     # Real-time CPU usage
sar -u 5 10                  # CPU utilization every 5 sec
mpstat 1                     # CPU statistics

# Memory analysis
free -m                      # Memory usage in MB
vmstat 1                     # Virtual memory statistics
sar -r 5 10                  # Memory utilization

# Disk I/O analysis
iotop                        # I/O usage by process
iostat -x 1                  # Extended I/O statistics
sar -d 1                     # Disk activity

# Network analysis
iftop -i eth0                # Network traffic
netstat -i                   # Interface statistics
ss -s                        # Socket statistics
```

### Process Analysis
```bash
# Find resource-heavy processes
ps aux --sort=-%cpu | head -10      # Top CPU consumers
ps aux --sort=-%mem | head -10      # Top memory consumers
pgrep -l httpd | wc -l              # Count Apache processes

# Analyze specific process
lsof -p PID                         # Files opened by process
strace -p PID                       # System calls
/proc/PID/status                    # Process status
cat /proc/PID/limits                # Process limits
```

---

## Cron Jobs & Automation

### Cron Management
```bash
# User crontabs
crontab -e                   # Edit user cron
crontab -l                   # List user cron jobs
crontab -r                   # Remove user crontab

# System crontabs
sudo nano /etc/crontab       # System cron file
ls /etc/cron.d/             # Additional cron files
ls /etc/cron.{hourly,daily,weekly,monthly}/

# Cron format: minute hour day month dayofweek command
# Examples:
0 2 * * * /backup/script.sh          # Daily at 2 AM
*/15 * * * * /check/script.sh        # Every 15 minutes
0 0 1 * * /monthly/script.sh         # First day of month
```

### Automation Scripts
```bash
# System monitoring script
#!/bin/bash
LOAD=$(uptime | awk '{print $10}' | cut -d, -f1)
if (( $(echo "$LOAD > 2.0" | bc -l) )); then
    echo "High load: $LOAD" | mail -s "Alert" admin@domain.com
fi

# Log rotation script
#!/bin/bash
find /var/log -name "*.log" -size +100M -exec gzip {} \;
find /var/log -name "*.gz" -mtime +30 -delete
```

---

## Docker Management

### Docker Installation
```bash
# Install Docker
sudo apt update
sudo apt install docker.io
sudo systemctl enable docker
sudo usermod -aG docker $USER  # Add user to docker group
```

### Container Management
```bash
# Container operations
docker run -d --name webapp nginx       # Run container
docker ps                               # List running containers
docker ps -a                            # List all containers
docker stop container_name              # Stop container
docker start container_name             # Start container
docker restart container_name           # Restart container
docker rm container_name                # Remove container

# Container inspection
docker logs container_name              # View logs
docker exec -it container_name bash     # Access container
docker inspect container_name           # Container details
docker stats                            # Resource usage
```

### Image Management
```bash
# Image operations
docker images                           # List images
docker pull image_name                  # Download image
docker build -t myapp .                 # Build image
docker rmi image_name                   # Remove image
docker system prune                     # Clean unused resources
```

---

## Database Management

### MySQL/MariaDB
```bash
# Installation
sudo apt install mysql-server
sudo mysql_secure_installation

# User management
sudo mysql
CREATE USER 'username'@'localhost' IDENTIFIED BY 'password';
GRANT ALL PRIVILEGES ON database.* TO 'username'@'localhost';
FLUSH PRIVILEGES;

# Database operations
mysql -u root -p
SHOW DATABASES;
USE database_name;
SHOW TABLES;

# Configuration
sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf
sudo systemctl restart mysql
```

### PostgreSQL
```bash
# Installation
sudo apt install postgresql postgresql-contrib
sudo -u postgres psql

# User and database management
sudo -u postgres createuser --interactive username
sudo -u postgres createdb database_name
sudo -u postgres psql -c "ALTER USER username PASSWORD 'password';"

# Configuration
sudo nano /etc/postgresql/12/main/postgresql.conf
sudo systemctl restart postgresql
```

---

## Web Server Management

### Apache
```bash
# Installation and basic setup
sudo apt install apache2
sudo systemctl enable apache2

# Virtual hosts
sudo nano /etc/apache2/sites-available/example.com.conf

<VirtualHost *:80>
    ServerName example.com
    DocumentRoot /var/www/example.com
    ErrorLog ${APACHE_LOG_DIR}/example.com_error.log
    CustomLog ${APACHE_LOG_DIR}/example.com_access.log combined
</VirtualHost>

sudo a2ensite example.com.conf
sudo systemctl reload apache2

# Modules
sudo a2enmod rewrite           # Enable module
sudo a2dismod module_name      # Disable module
apache2ctl -M                  # List enabled modules
```

### Nginx
```bash
# Installation
sudo apt install nginx
sudo systemctl enable nginx

# Server blocks (virtual hosts)
sudo nano /etc/nginx/sites-available/example.com

server {
    listen 80;
    server_name example.com;
    root /var/www/example.com;
    index index.html index.php;
    
    location / {
        try_files $uri $uri/ =404;
    }
    
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/run/php/php7.4-fpm.sock;
    }
}

sudo ln -s /etc/nginx/sites-available/example.com /etc/nginx/sites-enabled/
sudo nginx -t                 # Test configuration
sudo systemctl reload nginx
```

---

## SSL/TLS Certificate Management

### Let's Encrypt with Certbot
```bash
# Install Certbot
sudo apt install certbot python3-certbot-apache  # For Apache
sudo apt install certbot python3-certbot-nginx   # For Nginx

# Obtain certificate
sudo certbot --apache -d example.com             # Apache
sudo certbot --nginx -d example.com              # Nginx

# Certificate management
sudo certbot certificates     # List certificates
sudo certbot renew --dry-run  # Test renewal
sudo certbot renew           # Renew certificates

# Auto-renewal
sudo crontab -e
0 12 * * * /usr/bin/certbot renew --quiet
```

### Manual SSL Configuration
```bash
# Generate private key and CSR
openssl genrsa -out private.key 2048
openssl req -new -key private.key -out certificate.csr

# Self-signed certificate
openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes
```

---

## Emergency Recovery

### System Recovery
```bash
# Boot from live USB/CD and mount system
sudo mount /dev/sda1 /mnt
sudo mount --bind /dev /mnt/dev
sudo mount --bind /proc /mnt/proc
sudo mount --bind /sys /mnt/sys
sudo chroot /mnt

# Fix GRUB
sudo grub-install /dev/sda
sudo update-grub

# Reset root password
sudo passwd root

# Check filesystem
sudo fsck -f /dev/sda1
```

### File Recovery
```bash
# Recover deleted files
sudo apt install testdisk photorec
sudo testdisk            # Partition recovery
sudo photorec            # File recovery

# Find recently deleted files
lsof | grep deleted

# Extundelete (ext3/ext4)
sudo extundelete /dev/sda1 --restore-all
```

### Service Recovery
```bash
# Reset failed services
sudo systemctl reset-failed
sudo systemctl daemon-reload

# Emergency mode
sudo systemctl rescue        # Single user mode
sudo systemctl emergency     # Emergency mode

# Check system integrity
debsums -c                   # Check installed packages
sudo apt check               # Check for broken packages
sudo apt -f install          # Fix broken packages
```

---

## Quick Reference Commands

### One-liners for Common Tasks
```bash
# Find large files
find / -type f -size +100M -ls 2>/dev/null

# Find old log files
find /var/log -name "*.log" -mtime +30

# Monitor network connections
watch -n 1 'ss -tuln'

# Check disk usage by directory
du -h /var | sort -hr | head -20

# Find processes using most CPU
ps aux | sort -nrk 3,3 | head -5

# Find processes using most memory
ps aux | sort -nrk 4,4 | head -5

# Check which process is using a file
lsof /path/to/file

# Find zombie processes
ps aux | awk '$8 ~ /^Z/ { print $2 }'

# Clean package cache
sudo apt clean && sudo apt autoremove

# Update system completely
sudo apt update && sudo apt upgrade && sudo snap refresh
```

---

## Emergency Contact Information

Remember to always:
- **Document changes** in a change log
- **Test configurations** before applying to production
- **Backup critical data** before major changes
- **Monitor logs** after making changes
- **Keep system updated** with security patches
- **Use version control** for configuration files
- **Set up monitoring** and alerting systems

This cheat sheet covers the most common scenarios you'll encounter as a Ubuntu server administrator. Keep it handy and customize it based on your specific environment and needs.
